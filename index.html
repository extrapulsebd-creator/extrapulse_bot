<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Extra Pulse Pro</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://libtl.com/sdk.js" data-zone="10527731" data-sdk="show_10527731"></script>

    <style>
        :root { --p: #4f46e5; --s: #f43f5e; --acc: #fbbf24; --bg: #f8fafc; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: #eff6ff; color: #1e293b; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* Header & Dynamic Elements */
        .header { padding: 20px; display: flex; align-items: center; justify-content: space-between; background: #fff; border-bottom: 2px solid #e2e8f0; }
        .u-pic { width: 50px; height: 50px; border-radius: 15px; border: 3px solid var(--p); object-fit: cover; }
        .bal-chip { background: linear-gradient(135deg, #fbbf24, #f59e0b); padding: 10px 16px; border-radius: 20px; color: #fff; font-weight: 800; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3); }

        #view { flex: 1; overflow-y: auto; padding: 20px 20px 140px; }
        .tab { display: none; } .tab.active { display: block; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Cards & Buttons */
        .card { background: #fff; border-radius: 28px; padding: 22px; margin-bottom: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); border: 1px solid #fff; }
        .btn-grad { background: linear-gradient(90deg, var(--p), #818cf8); color: #fff; border: none; padding: 16px; border-radius: 18px; width: 100%; font-weight: 800; font-size: 15px; cursor: pointer; transition: 0.3s; box-shadow: 0 6px 15px rgba(79, 70, 229, 0.2); }
        .btn-grad:disabled { background: #cbd5e1; box-shadow: none; cursor: not-allowed; }

        /* Bottom Navigation - Enlarged */
        .nav { position: fixed; bottom: 15px; left: 15px; right: 15px; background: #1e293b; border-radius: 30px; display: flex; padding: 15px 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 9999; }
        .n-link { flex: 1; text-align: center; color: #94a3b8; text-decoration: none; display: flex; flex-direction: column; align-items: center; gap: 6px; }
        .n-link i { font-size: 24px; } /* Icons Boro Kora Hoyeche */
        .n-link span { font-size: 11px; font-weight: 700; }
        .n-link.active { color: #fff; transform: translateY(-5px); transition: 0.3s; }
        .n-link.active i { color: var(--acc); }

        /* Custom Styles */
        .icon-box { width: 48px; height: 48px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .rank-row { display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #f1f5f9; border-radius: 18px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <header class="header">
        <div style="display:flex; align-items:center; gap:12px;">
            <img src="" id="u-pic" class="u-pic">
            <div><p id="u-nm" style="font-weight:800; font-size:18px; color:#1e293b;">Loading...</p></div>
        </div>
        <div class="bal-chip"><i class="fas fa-coins"></i> <span id="u-bl">0</span></div>
    </header>

    <main id="view">
        <div id="home" class="tab active">
            <div class="card" style="background: linear-gradient(45deg, #4f46e5, #ec4899); color: #fff;">
                <h2 style="font-size: 22px;"><i class="fas fa-gift"></i> Daily Reward</h2>
                <p style="margin: 10px 0 20px; font-size: 14px; opacity: 0.9;">Claim your 25 EP once every 24h.</p>
                <button class="btn-grad" id="clm-btn" style="background:#fff; color:#4f46e5;" onclick="claimDaily()">CLAIM NOW</button>
            </div>
            
            <h4 style="margin: 20px 0 15px; color: #64748b; font-weight: 800;">Earn More Coins</h4>
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="display:flex; align-items:center; gap:15px;">
                        <div class="icon-box" style="background:#fef2f2; color:#ef4444;"><i class="fas fa-play-circle"></i></div>
                        <div><b style="font-size:16px;">Watch Ad</b><br><small style="color:#10b981;">+10 EP Coin</small></div>
                    </div>
                    <button class="btn-grad" style="width:auto; padding:12px 25px;" onclick="doAd(10)">WATCH</button>
                </div>
            </div>
        </div>

        <div id="tasks" class="tab">
            <h3 style="margin-bottom:20px;">Social Missions</h3>
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; padding-bottom:15px; border-bottom:1.5px solid #f1f5f9;">
                    <div style="display:flex; align-items:center; gap:15px;">
                        <div class="icon-box" style="background:#e0f2fe; color:#0ea5e9;"><i class="fab fa-telegram-plane"></i></div>
                        <div><b>Telegram</b><br><small>+50 EP</small></div>
                    </div>
                    <button class="btn-grad" id="t-tg" style="width:auto; padding:10px 20px;" onclick="doTask('tg', 'https://t.me/your_channel', 50)">JOIN</button>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center; padding-top:15px;">
                    <div style="display:flex; align-items:center; gap:15px;">
                        <div class="icon-box" style="background:#fee2e2; color:#ef4444;"><i class="fab fa-youtube"></i></div>
                        <div><b>YouTube</b><br><small>+50 EP</small></div>
                    </div>
                    <button class="btn-grad" id="t-yt" style="width:auto; padding:10px 20px;" onclick="doTask('yt', 'https://youtube.com/@your_channel', 50)">SUB</button>
                </div>
            </div>
        </div>

        <div id="leaderboard" class="tab">
            <h3 style="margin-bottom:20px;">Top Earners</h3>
            <div id="rank-list"></div>
        </div>

        <div id="play" class="tab">
            <div class="card" style="text-align:center;">
                <h3 style="font-size:22px;">Lucky Spin</h3>
                <p id="s-timer" style="color:var(--s); font-weight:800; margin:10px 0;"></p>
                <p id="s-rem" style="font-size:14px; font-weight:700; margin-bottom:15px;">Spins Available: 5/5</p>
                <div id="wheel" style="width:200px; height:200px; border:10px solid #1e293b; border-radius:50%; margin:20px auto; background: conic-gradient(#4f46e5 0 90deg, #f43f5e 90deg 180deg, #4f46e5 180deg 270deg, #f43f5e 270deg 360deg); transition: 4s cubic-bezier(0.1, 0, 0.1, 1);"></div>
                <button class="btn-grad" id="spn-btn" onclick="spinWheel()">SPIN TO WIN</button>
            </div>
        </div>

        <div id="profile" class="tab">
            <div class="card" style="text-align:center; background: linear-gradient(180deg, #fff, #f1f5f9);">
                <img src="" id="p-img" style="width:110px; height:110px; border-radius:30px; border:5px solid #fff; box-shadow: 0 10px 20px rgba(0,0,0,0.1); margin-bottom:15px;">
                <h2 id="p-nm">User</h2>
                <p style="font-size:13px; color:#64748b; margin-top:5px;">Joined: <span id="p-date">...</span></p>
                <div style="margin-top:25px; text-align:left;">
                    <div style="display:flex; justify-content:space-between; font-weight:800; font-size:13px; color:var(--p);">
                        <span>Level <span id="p-lvl">1</span></span>
                        <span id="p-xp-txt">0/100 XP</span>
                    </div>
                    <div style="height:12px; background:#e2e8f0; border-radius:10px; margin-top:8px; overflow:hidden;">
                        <div id="xp-f" style="height:100%; background:linear-gradient(90deg, var(--p), var(--s)); width:0%; transition:1.5s;"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="wallet" class="tab">
            <h3>Withdrawal</h3>
            <div class="card">
                <p style="font-size:12px; color:#64748b;">Current EP Balance</p>
                <h1 style="color:var(--p); font-size:32px; margin-bottom:20px;"><span id="w-bal">0</span> EP</h1>
                
                <input type="number" id="w-a" class="btn-grad" style="background:#f8fafc; color:#1e293b; text-align:left; border:1px solid #e2e8f0; margin-bottom:15px;" placeholder="Amount (Min 1000)">
                <select id="w-m" class="btn-grad" style="background:#f8fafc; color:#1e293b; text-align:left; border:1px solid #e2e8f0; margin-bottom:15px;">
                    <option value="bKash">bKash</option>
                    <option value="Nagad">Nagad</option>
                    <option value="Binance">Binance (UID)</option>
                </select>
                <input type="text" id="w-n" class="btn-grad" style="background:#f8fafc; color:#1e293b; text-align:left; border:1px solid #e2e8f0; margin-bottom:20px;" placeholder="Number / UID">
                
                <button class="btn-grad" style="background:#10b981;" onclick="withdraw()">SUBMIT REQUEST</button>
            </div>
        </div>
    </main>

    <nav class="nav">
        <a href="javascript:void(0)" class="n-link active" onclick="tab('home',this)"><i class="fas fa-home"></i><span>Home</span></a>
        <a href="javascript:void(0)" class="n-link" onclick="tab('tasks',this)"><i class="fas fa-tasks"></i><span>Tasks</span></a>
        <a href="javascript:void(0)" class="n-link" onclick="tab('leaderboard',this)"><i class="fas fa-trophy"></i><span>Rank</span></a>
        <a href="javascript:void(0)" class="n-link" onclick="tab('play',this)"><i class="fas fa-gamepad"></i><span>Spin</span></a>
        <a href="javascript:void(0)" class="n-link" onclick="tab('wallet',this)"><i class="fas fa-wallet"></i><span>Wallet</span></a>
        <a href="javascript:void(0)" class="n-link" onclick="tab('profile',this)"><i class="fas fa-user-circle"></i><span>User</span></a>
    </nav>

    <script>
        const cfg = { apiKey: "AIzaSyAuS8RpixezmpBpIlB0YQURpG6s-0LEvKM", databaseURL: "https://extra-pulse-default-rtdb.firebaseio.com" };
        firebase.initializeApp(cfg); const db = firebase.database(); 
        const tg = window.Telegram.WebApp; tg.expand();
        
        // AUTO SYNC TELEGRAM DATA
        const u = tg.initDataUnsafe.user || { id: "0000", first_name: "Premium User", photo_url: "" };
        const uid = u.id, fname = u.first_name;
        const photo = u.photo_url || `https://ui-avatars.com/api/?name=${fname}&background=4f46e5&color=fff&size=128`;

        let uData = {};

        function start() {
            db.ref('users/'+uid).on('value', s => {
                uData = s.val() || {
                    balance: 0, xp: 0, name: fname, photo: photo,
                    joined: new Date().toLocaleDateString(),
                    lastBonus: 0, spins: 5, spinTime: 0, tasks: {}
                };
                if(!s.exists()) db.ref('users/'+uid).set(uData);
                syncUI();
            });
            loadRank();
        }

        function syncUI() {
            document.getElementById('u-bl').innerText = uData.balance || 0;
            document.getElementById('w-bal').innerText = uData.balance || 0;
            document.getElementById('u-nm').innerText = uData.name;
            document.getElementById('p-nm').innerText = uData.name;
            document.getElementById('u-pic').src = uData.photo;
            document.getElementById('p-img').src = uData.photo;
            document.getElementById('p-date').innerText = uData.joined;

            // Level Logic
            const lvl = Math.floor((uData.xp || 0) / 100) + 1;
            document.getElementById('p-lvl').innerText = lvl;
            document.getElementById('p-xp-txt').innerText = ((uData.xp||0)%100) + "/100 XP";
            document.getElementById('xp-f').style.width = ((uData.xp||0)%100) + "%";

            // Daily Bonus Logic (24h)
            const now = Date.now();
            const canClaim = (now - (uData.lastBonus || 0)) > 86400000;
            document.getElementById('clm-btn').disabled = !canClaim;
            document.getElementById('clm-btn').innerText = canClaim ? "CLAIM 25 EP" : "CLAIMED (Back Tomorrow)";

            // Hourly Spin Logic (5 spins per 1h)
            if (now - (uData.spinTime || 0) > 3600000) {
                db.ref('users/'+uid).update({ spins: 5, spinTime: now });
            }
            document.getElementById('s-rem').innerText = `Spins Available: ${uData.spins}/5`;
            document.getElementById('spn-btn').disabled = (uData.spins <= 0);
            
            // Task Lock Logic
            if(uData.tasks?.tg) document.getElementById('t-tg').disabled = true;
            if(uData.tasks?.yt) document.getElementById('t-yt').disabled = true;
        }

        function claimDaily() {
            showAd(() => {
                db.ref('users/'+uid).transaction(c => {
                    if(c) { c.balance += 25; c.xp += 20; c.lastBonus = Date.now(); }
                    return c;
                });
                tg.showAlert("Daily Reward Claimed!");
            });
        }

        function spinWheel() {
            if (uData.spins <= 0) return;
            showAd(() => {
                const w = document.getElementById('wheel');
                const deg = 3600 + Math.floor(Math.random() * 3600);
                w.style.transform = `rotate(${deg}deg)`;
                document.getElementById('spn-btn').disabled = true;
                
                setTimeout(() => {
                    const win = [5, 10, 15, 20, 50][Math.floor(Math.random()*5)];
                    db.ref('users/'+uid).transaction(c => {
                        if(c) { c.balance += win; c.xp += 5; c.spins -= 1; }
                        return c;
                    });
                    tg.showAlert(`You won ${win} EP!`);
                }, 4000);
            });
        }

        function doTask(id, link, r) {
            if(uData.tasks && uData.tasks[id]) return;
            tg.openLink(link);
            setTimeout(() => {
                db.ref('users/'+uid).transaction(c => {
                    if(c && (!c.tasks || !c.tasks[id])) {
                        if(!c.tasks) c.tasks = {};
                        c.tasks[id] = true;
                        c.balance += r; c.xp += 15;
                    }
                    return c;
                });
                tg.showAlert("Task Verified! +"+r+" EP");
            }, 5000);
        }

        function doAd(a) {
            showAd(() => {
                db.ref('users/'+uid).transaction(c => {
                    if(c) { c.balance += a; c.xp += 5; }
                    return c;
                });
            });
        }

        function loadRank() {
            db.ref('users').orderByChild('balance').limitToLast(10).on('value', s => {
                let list = []; s.forEach(u => list.push(u.val()));
                let h = ""; list.reverse().forEach((u, i) => {
                    h += `<div class="rank-row">
                        <div style="display:flex; align-items:center; gap:12px;">
                            <b style="color:var(--p); width:20px;">#${i+1}</b>
                            <img src="${u.photo}" style="width:35px; height:35px; border-radius:50%; border:1px solid #ddd;">
                            <span style="font-weight:700; font-size:14px;">${u.name}</span>
                        </div>
                        <b style="color:#f59e0b;">${u.balance} EP</b>
                    </div>`;
                });
                document.getElementById('rank-list').innerHTML = h;
            });
        }

        function withdraw() {
            const a = parseInt(document.getElementById('w-a').value);
            const n = document.getElementById('w-n').value;
            if(!a || a < 1000 || !n) return tg.showAlert("Min 1000 EP required!");
            if(uData.balance < a) return tg.showAlert("Insufficient Balance!");
            
            showAd(() => {
                db.ref('payouts/'+uid+'/'+Date.now()).set({
                    amount: a, method: document.getElementById('w-m').value, address: n, status: 'pending'
                });
                db.ref('users/'+uid+'/balance').transaction(b => b - a);
                tg.showAlert("Withdrawal Request Submitted!");
            });
        }

        function showAd(cb) {
            if(typeof show_10527731 === 'function') {
                show_10527731().then(() => cb()).catch(() => cb());
            } else { cb(); }
        }

        function tab(id, el) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.n-link').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            tg.HapticFeedback.impactOccurred('medium');
        }

        window.onload = start;
    </script>
</body>
</html>
